<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:Tessera.ViewModels"
        xmlns:views="clr-namespace:Tessera.Views"
        xmlns:anim="clr-namespace:Avalonia.Animation;assembly=Avalonia.Animation"
        xmlns:controls="clr-namespace:Avalonia.Controls;assembly=Avalonia.Controls"
        x:Class="Tessera.Views.MainWindow"
        Title="Tessera"
        Width="1200" Height="800"
        Background="{DynamicResource PageBackgroundBrush}">
  <Window.DataTemplates>
    <DataTemplate DataType="vm:TableViewModel">
      <views:TableView />
    </DataTemplate>
    <DataTemplate DataType="vm:SchemaViewModel">
      <views:SchemaView />
    </DataTemplate>
    <DataTemplate DataType="vm:JsonViewModel">
      <views:JsonView />
    </DataTemplate>
  </Window.DataTemplates>

  <Grid RowDefinitions="Auto,*" ColumnDefinitions="240,*">
    <Border Grid.Row="0" Grid.ColumnSpan="2" Background="{DynamicResource SurfaceBrush}" Padding="18" BoxShadow="0 2 12 #1A000000" CornerRadius="10">
      <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="16" VerticalAlignment="Center">
        <StackPanel Orientation="Vertical" Spacing="2">
          <TextBlock Text="Tessera â€“ CSV Editor" FontSize="18" Foreground="{DynamicResource TextPrimaryBrush}" FontWeight="SemiBold" />
          <TextBlock Text="{Binding CurrentFileName}" Foreground="{DynamicResource TextSecondaryBrush}" />
        </StackPanel>

        <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
          <Border Background="{DynamicResource StrongSurfaceBrush}" Padding="10,6" CornerRadius="8" BorderBrush="{DynamicResource BorderBrushLight}" BorderThickness="1">
            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
              <Ellipse Width="10" Height="10" Fill="{DynamicResource AccentBrush}">
                <Ellipse.Style>
                  <Style Selector="Ellipse">
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding Status}" Value="Editing">
                        <Setter Property="Fill" Value="{DynamicResource WarningBrush}" />
                      </DataTrigger>
                      <DataTrigger Binding="{Binding Status}" Value="Error">
                        <Setter Property="Fill" Value="{DynamicResource ErrorBrush}" />
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </Ellipse.Style>
              </Ellipse>
              <TextBlock Text="{Binding StatusMessage}" Foreground="{DynamicResource TextPrimaryBrush}" />
            </StackPanel>
          </Border>
        </StackPanel>

        <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
          <Button Content="Reload" Command="{Binding ReloadCommand}" Background="{DynamicResource StrongSurfaceBrush}" Foreground="{DynamicResource TextPrimaryBrush}" BorderBrush="{DynamicResource BorderBrushLight}"/>
          <Button Content="Save" Command="{Binding SaveCommand}" Background="{DynamicResource AccentBrush}" Foreground="White" BorderBrush="{DynamicResource AccentBrush}"/>
          <ToggleSwitch Content="Dark" IsChecked="{Binding IsDarkMode, Mode=TwoWay}"/>
        </StackPanel>
      </Grid>
    </Border>

    <Border Grid.Row="1" Grid.Column="0" Margin="16,16,8,16" Background="{DynamicResource SurfaceBrush}" Padding="16" BoxShadow="0 10 30 #1A000000">
      <StackPanel Spacing="12">
        <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
          <TextBlock Text="Navigation" FontWeight="SemiBold" FontSize="16" Foreground="{DynamicResource TextPrimaryBrush}" />
          <Border Background="{DynamicResource AccentBrush}" Width="8" Height="8" CornerRadius="4" />
        </StackPanel>
        <ListBox Items="{Binding Views}" SelectedItem="{Binding ActiveView, Mode=TwoWay}" BorderThickness="0" Background="Transparent">
          <ListBox.ItemTemplate>
            <DataTemplate>
              <Border Padding="12" Margin="0,4" Background="{DynamicResource SurfaceBrush}" CornerRadius="8" BorderBrush="{DynamicResource BorderBrushLight}" BorderThickness="1">
                <Border.Transitions>
                  <Transitions>
                    <anim:DoubleTransition Property="Opacity" Duration="{DynamicResource TransitionDuration}" />
                  </Transitions>
                </Border.Transitions>
                <Border.Styles>
                  <Style Selector="Border">
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding IsSelected}" Value="True">
                        <Setter Property="Background" Value="{DynamicResource StrongSurfaceBrush}" />
                        <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}" />
                        <Setter Property="BoxShadow" Value="0 8 24 #1A000000" />
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </Border.Styles>
                <StackPanel Orientation="Vertical" Spacing="2">
                  <TextBlock Text="{Binding Title}" Foreground="{DynamicResource TextPrimaryBrush}" FontWeight="SemiBold" />
                  <TextBlock Text="{Binding Subtitle}" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12" />
                </StackPanel>
              </Border>
            </DataTemplate>
          </ListBox.ItemTemplate>
          <ListBox.Styles>
            <Style Selector="ListBoxItem">
              <Setter Property="BorderThickness" Value="0" />
              <Setter Property="Padding" Value="0" />
              <Setter Property="Margin" Value="0" />
              <Setter Property="Background" Value="Transparent" />
              <Setter Property="Transitions">
                <Transitions>
                  <anim:DoubleTransition Property="Opacity" Duration="{DynamicResource TransitionDuration}" />
                </Transitions>
              </Setter>
              <Setter Property="Template">
                <Setter.Value>
                  <ControlTemplate>
                    <ContentPresenter />
                  </ControlTemplate>
                </Setter.Value>
              </Setter>
            </Style>
          </ListBox.Styles>
        </ListBox>
      </StackPanel>
    </Border>

    <Border Grid.Row="1" Grid.Column="1" Margin="8,16,16,16" Background="{DynamicResource SurfaceBrush}" Padding="14" BoxShadow="0 10 30 #1A000000">
      <controls:TransitioningContentControl Content="{Binding ActiveView}">
        <controls:TransitioningContentControl.Transition>
          <anim:CrossFade Duration="{DynamicResource TransitionDuration}" />
        </controls:TransitioningContentControl.Transition>
      </controls:TransitioningContentControl>
    </Border>

    <ItemsControl Grid.Row="1" Grid.Column="1" Items="{Binding ToastAgent.Toasts}" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,24,24" Panel.ZIndex="5">
      <ItemsControl.ItemsPanel>
        <ItemsPanelTemplate>
          <StackPanel Spacing="10" />
        </ItemsPanelTemplate>
      </ItemsControl.ItemsPanel>
      <ItemsControl.ItemTemplate>
        <DataTemplate>
          <Border Background="{DynamicResource StrongSurfaceBrush}" Padding="12" CornerRadius="10" BoxShadow="0 8 24 #26000000" IsVisible="{Binding IsVisible}">
            <Border.Transitions>
              <Transitions>
                <anim:DoubleTransition Property="Opacity" Duration="{DynamicResource TransitionDuration}" />
              </Transitions>
            </Border.Transitions>
            <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
              <Border Width="12" Height="12" CornerRadius="6">
                <Border.Style>
                  <Style Selector="Border">
                    <Setter Property="Background" Value="{DynamicResource AccentBrush}" />
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding Level}" Value="Warning">
                        <Setter Property="Background" Value="{DynamicResource WarningBrush}" />
                      </DataTrigger>
                      <DataTrigger Binding="{Binding Level}" Value="Error">
                        <Setter Property="Background" Value="{DynamicResource ErrorBrush}" />
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </Border.Style>
              </Border>
              <StackPanel Orientation="Vertical" Spacing="2" Width="240">
                <TextBlock Text="{Binding Message}" Foreground="{DynamicResource TextPrimaryBrush}" TextWrapping="Wrap" />
                <TextBlock Text="Tap to dismiss" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="11" />
              </StackPanel>
              <Button Content="Close" Command="{Binding DismissCommand}" />
            </StackPanel>
          </Border>
        </DataTemplate>
      </ItemsControl.ItemTemplate>
    </ItemsControl>
  </Grid>
</Window>
