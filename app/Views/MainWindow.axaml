<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:Tessera.ViewModels"
        xmlns:layout="clr-namespace:Tessera.Views.Layout"
        xmlns:controls="clr-namespace:Avalonia.Controls;assembly=Avalonia.Controls"
        x:Class="Tessera.Views.MainWindow"
        Title="Tessera"
        Icon="/Assets/icon.png"
        Width="1200" Height="800"
        Background="{DynamicResource PageBackgroundBrush}">

  <Grid RowDefinitions="Auto,*">
    <Grid.KeyBindings>
        <KeyBinding Gesture="Ctrl+S" Command="{Binding SaveCommand}" />
        <KeyBinding Gesture="Cmd+S" Command="{Binding SaveCommand}" />
    </Grid.KeyBindings>
    <!-- Top Bar -->
    <layout:TopBarView Grid.Row="0" />

    <!-- Main Content Area -->
    <Grid Grid.Row="1">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="280" MinWidth="200" MaxWidth="600"/>
        <ColumnDefinition Width="*"/>
      </Grid.ColumnDefinitions>

      <!-- Sidebar Content (Direct child of Grid) -->
      <!-- Margin-right 1px to make room for the border -->
      <layout:SidebarContainerView Grid.Column="0" Margin="0,0,1,0" ZIndex="0"/>
      
      <!-- Visual Border Line (Right Edge of Column 0) -->
      <Border Grid.Column="0" HorizontalAlignment="Right" VerticalAlignment="Stretch" Width="1" Background="{DynamicResource BorderBrushLight}" ZIndex="1"/>
      
      <!-- Grid Splitter (Overlay, Right Aligned in Col 0) -->
      <!-- MUST be direct child of Grid to work. Width 5px for easier grabbing. -->
      <GridSplitter Grid.Column="0" HorizontalAlignment="Right" VerticalAlignment="Stretch" 
                    Width="5" Background="Transparent" ResizeDirection="Columns" ZIndex="100">
         <GridSplitter.Template>
           <ControlTemplate>
             <Border Background="Transparent" />
           </ControlTemplate>
         </GridSplitter.Template>
      </GridSplitter>

       <!-- Main Content Panel -->
       <layout:MainContentView Grid.Column="1" />

       <!-- Toast Overlay -->
       <ItemsControl Grid.Column="1" ItemsSource="{Binding ToastAgent.Toasts}" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,24,24" ZIndex="100">
         <ItemsControl.ItemsPanel>
           <ItemsPanelTemplate>
             <StackPanel Spacing="10" />
           </ItemsPanelTemplate>
         </ItemsControl.ItemsPanel>
         <ItemsControl.ItemTemplate>
           <DataTemplate>
             <Border Background="{DynamicResource StrongSurfaceBrush}" Padding="12" CornerRadius="8" BoxShadow="0 4 12 #26000000" IsVisible="{Binding IsVisible}" BorderBrush="{DynamicResource BorderBrushLight}" BorderThickness="1">
               <Border.Transitions>
                 <Transitions>
                   <DoubleTransition Property="Opacity" Duration="{DynamicResource TransitionDuration}" />
                 </Transitions>
               </Border.Transitions>
               <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                 <Border Width="4" Height="32" CornerRadius="2" Background="{Binding BackgroundBrush}" />
                 <StackPanel Orientation="Vertical" Spacing="2" Width="220">
                   <TextBlock Text="{Binding Message}" Foreground="{DynamicResource TextPrimaryBrush}" TextWrapping="Wrap" FontWeight="Medium" />
                   <TextBlock Text="Notification" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="10" />
                 </StackPanel>
                 <Button Content="âœ•" Command="{Binding DismissCommand}" Background="Transparent" BorderThickness="0" Padding="4" Foreground="{DynamicResource TextSecondaryBrush}"/>
               </StackPanel>
             </Border>
           </DataTemplate>
         </ItemsControl.ItemTemplate>
       </ItemsControl>
    </Grid>
  </Grid>
</Window>
