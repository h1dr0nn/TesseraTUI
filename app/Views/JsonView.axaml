<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:ae="clr-namespace:AvaloniaEdit;assembly=AvaloniaEdit"
             x:Class="Tessera.Views.JsonView">
  <Grid RowDefinitions="Auto,*" Background="{DynamicResource PageBackgroundBrush}">
    <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,0,0,12" VerticalAlignment="Center">
      <Border Background="{DynamicResource StrongSurfaceBrush}" Padding="10,6" CornerRadius="8" BorderBrush="{DynamicResource BorderBrushLight}" BorderThickness="1">
        <StackPanel Orientation="Vertical" Spacing="2">
          <TextBlock Text="Current file" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12" />
          <TextBlock Text="{Binding CurrentFileName}" Foreground="{DynamicResource TextPrimaryBrush}" FontWeight="SemiBold" />
        </StackPanel>
      </Border>
      <Border Background="{DynamicResource StrongSurfaceBrush}" Padding="10,6" CornerRadius="8" BorderBrush="{DynamicResource BorderBrushLight}" BorderThickness="1">
        <StackPanel Orientation="Vertical" Spacing="2">
          <TextBlock Text="Status" Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12" />
          <TextBlock Text="{Binding StatusMessage}" Foreground="{DynamicResource TextPrimaryBrush}" />
        </StackPanel>
      </Border>
    </StackPanel>

    <Grid Grid.Row="1">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
      </Grid.RowDefinitions>

      <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
        <Button Content="Apply Changes" Command="{Binding ApplyChangesCommand}" IsEnabled="{Binding CanApply}" HorizontalAlignment="Left" Padding="12,6"/>
        <Button Content="Reset" Command="{Binding ResetCommand}" Padding="12,6" />
        <Button Content="Format JSON" Command="{Binding FormatCommand}" Padding="12,6" />
        <StackPanel Orientation="Horizontal" Spacing="6" Margin="12,0,0,0" VerticalAlignment="Center">
          <Ellipse Width="10" Height="10" Fill="{DynamicResource AccentBrush}" />
          <TextBlock Text="Live validation" Foreground="{DynamicResource TextSecondaryBrush}" />
        </StackPanel>
      </StackPanel>

      <Grid Grid.Row="1" ColumnDefinitions="3*,*" ColumnSpacing="12">
        <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="10" Padding="10" BorderBrush="{DynamicResource BorderBrushLight}" BorderThickness="1" BoxShadow="0 8 30 #1A000000">
          <StackPanel Spacing="8">
            <ae:TextEditor Name="JsonEditor"
                           ShowLineNumbers="True"
                           FontFamily="Consolas,Menlo,monospace"
                           Background="{DynamicResource StrongSurfaceBrush}"
                           Foreground="{DynamicResource TextPrimaryBrush}"
                           BorderThickness="1"
                           BorderBrush="{DynamicResource BorderBrushLight}"
                           Text="{Binding EditorText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
              <TextBlock Text="{Binding ValidationMessage}" Foreground="{DynamicResource TextSecondaryBrush}" />
              <TextBlock Text="Apply disabled until validation passes" Foreground="{DynamicResource TextSecondaryBrush}" IsVisible="{Binding CanApply, Converter={StaticResource InverseBoolConverter}}" />
            </StackPanel>
          </StackPanel>
        </Border>

        <Border Grid.Column="1" Background="{DynamicResource StrongSurfaceBrush}" CornerRadius="10" Padding="12" BorderBrush="{DynamicResource BorderBrushLight}" BorderThickness="1">
          <StackPanel Spacing="8">
            <TextBlock Text="Warnings" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryBrush}" />
            <ItemsControl Items="{Binding Warnings}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <StackPanel Orientation="Horizontal" Spacing="6">
                    <Path Data="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2Zm0 3 5 9H7l5-9Zm0 11.2a1.2 1.2 0 1 1 0 2.4 1.2 1.2 0 0 1 0-2.4Z" Fill="{DynamicResource WarningBrush}" Width="16" Height="16" />
                    <TextBlock Text="{Binding .}" Foreground="{DynamicResource TextSecondaryBrush}" />
                  </StackPanel>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
              <ItemsControl.Empty>
                <TextBlock Text="No mismatches detected" Foreground="{DynamicResource TextSecondaryBrush}" />
              </ItemsControl.Empty>
            </ItemsControl>
          </StackPanel>
        </Border>
      </Grid>

      <Border Grid.RowSpan="2" Background="#88000000" IsVisible="{Binding IsDiffOpen}">
        <Border Width="460" Background="{DynamicResource SurfaceBrush}" Padding="16" CornerRadius="12" BorderBrush="{DynamicResource BorderBrushLight}" BorderThickness="1" HorizontalAlignment="Center" VerticalAlignment="Center" BoxShadow="0 8 30 #22000000">
          <StackPanel Spacing="10">
            <TextBlock Text="Diff preview" FontSize="18" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryBrush}" />
            <TextBlock Text="Review changes before committing to the table" Foreground="{DynamicResource TextSecondaryBrush}" />
            <StackPanel Orientation="Horizontal" Spacing="10">
              <Border Background="#1933AA55" Padding="8" CornerRadius="8">
                <TextBlock Text="Added" Foreground="{DynamicResource TextPrimaryBrush}" />
                <TextBlock Text="{Binding DiffPreview.AddedRows.Count}" FontWeight="Bold" />
              </Border>
              <Border Background="#19AA3333" Padding="8" CornerRadius="8">
                <TextBlock Text="Removed" Foreground="{DynamicResource TextPrimaryBrush}" />
                <TextBlock Text="{Binding DiffPreview.RemovedRows.Count}" FontWeight="Bold" />
              </Border>
              <Border Background="#19EECC33" Padding="8" CornerRadius="8">
                <TextBlock Text="Modified" Foreground="{DynamicResource TextPrimaryBrush}" />
                <TextBlock Text="{Binding DiffPreview.ModifiedRows.Count}" FontWeight="Bold" />
              </Border>
            </StackPanel>
            <ItemsControl Items="{Binding DiffPreview.KeyMismatches}">
              <ItemsControl.ItemTemplate>
                <DataTemplate>
                  <TextBlock Foreground="{DynamicResource WarningBrush}" Text="{Binding Key}" />
                </DataTemplate>
              </ItemsControl.ItemTemplate>
              <ItemsControl.Empty>
                <TextBlock Text="Keys match schema" Foreground="{DynamicResource TextSecondaryBrush}" />
              </ItemsControl.Empty>
            </ItemsControl>
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8">
              <Button Content="Cancel" Command="{Binding ResetCommand}" Padding="12,6" />
              <Button Content="Commit" Command="{Binding ConfirmApplyCommand}" Padding="12,6" />
            </StackPanel>
          </StackPanel>
        </Border>
      </Border>
    </Grid>
  </Grid>
</UserControl>
